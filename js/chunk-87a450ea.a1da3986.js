(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-87a450ea"],{"2f56":function(t,e,a){},"31a9":function(t,e,a){"use strict";a("a5b9")},"6e7a":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"v-feedback"},[t.id?[a("div",{staticClass:"m-feedback-single-panel"},[a("el-button",{attrs:{size:"mini",icon:"el-icon-arrow-left"},on:{click:t.goBack}},[t._v("返回列表")]),a("a",{staticClass:"u-email",attrs:{href:t.feedback_url,target:"_blank"}},[a("i",{staticClass:"el-icon-phone-outline"}),t._v("快捷邮件 ")])],1),a("div",{staticClass:"m-single-feedback-container"},[a("feedback-item",{attrs:{mode:"single","feedback-id":t.id}})],1)]:[a("h2",{staticClass:"m-feedback-title"},[a("i",{staticClass:"u-icon el-icon-message"}),a("span",{staticClass:"u-title"},[t._v("反馈建议")]),a("a",{staticClass:"u-email",attrs:{href:t.feedback_url,target:"_blank"}},[a("i",{staticClass:"el-icon-phone-outline"}),t._v("快捷邮件 ")])]),a("publish-feedback",{on:{update:t.handleFeedbackUpdate}}),a("listbox",{attrs:{data:t.data,total:t.total,pages:t.pages,per:t.per,page:t.page},on:{appendPage:t.appendPage,changePage:t.changePage}},[a("template",{slot:"filter"},[a("clientBy",{attrs:{type:t.client},on:{filter:t.filter}}),a("orderBy",{on:{filter:t.filter}})],1),t.data.length?a("div",{staticClass:"m-feedback-list"},[a("ul",{staticClass:"u-list"},t._l(t.data,(function(e,i){return a("li",{key:i,staticClass:"u-item"},[a("feedback-item",{attrs:{data:e,order:t.order},on:{update:t.handleUpdate}})],1)})),0)]):t._e()],2)]],2)},n=[],s=a("2909"),o=(a("ac1f"),a("841c"),a("d3b7"),a("99af"),a("d81d"),a("a15b"),a("b64b"),a("159b"),a("4de4"),a("a0dd")),r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"m-feedback-publish"},[a("el-alert",{staticClass:"u-msg",attrs:{title:"如涉及账号等私人信息请发送电子邮件至admin@jx3box.com",type:"warning","show-icon":""}}),a("el-input",{attrs:{type:"textarea",placeholder:"写下你想说的...","show-word-limit":"",maxlength:1024,rows:4},model:{value:t.post.post_content,callback:function(e){t.$set(t.post,"post_content",e)},expression:"post.post_content"}}),a("div",{staticClass:"m-feedback-actions"},[a("el-upload",{ref:"upload",staticClass:"u-upload avatar-uploader",attrs:{action:t.url,"list-type":"picture-card","on-remove":t.remove,"on-success":t.done,"on-error":t.fail,"on-exceed":t.exceed,limit:t.max,title:"上传图片","with-credentials":"",accept:"image/jpg, image/jpeg, image/gif, image/png, image/bmp"}},[a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]),a("div",{staticClass:"u-submit"},[a("el-button",{attrs:{loading:t.processing,icon:"el-icon-s-promotion",type:"primary"},on:{click:t.publish}},[t._v("提交")])],1)],1)],1)},c=[];a("a4d3"),a("e439"),a("dbb4");function l(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function u(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function d(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?u(Object(a),!0).forEach((function(e){l(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):u(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}a("fb6a"),a("b0c0");var p=a("65c2"),f=a("c9d2"),h=a("41cb");function g(t){return Object(h["b"])().post("/api/cms/post",t)}var m=p["__cms"],b=m+"api/cms/upload",v={name:"publishFeedback",data:function(){return{imgs:[],url:b,max:8,post:{ID:"",post_status:"publish",post_type:"feedback",post_title:"",post_subtype:"0",post_meta:{},post_content:"",post_mode:"",original:1,client:this.client||"all",lang:"cn",zlp:"",post_excerpt:"",post_banner:"",post_collection:"",comment:0,visible:0,tags:[]},processing:!1,user:f["a"].getInfo()}},computed:{client:function(){return this.$store.state.client}},methods:{done:function(t){this.imgs=[].concat(Object(s["a"])(this.imgs),[t.data[0]])},fail:function(t){try{var e=JSON.parse(t.message);this.$message.error("[".concat(e.code,"]").concat(e.msg))}catch(a){this.$message.error("网络请求异常")}},exceed:function(){this.$message.warning("上传的图片个数最多为".concat(this.max,"个"))},remove:function(t){this.imgs=this.imgs.filter((function(e){var a;return e!==(null===t||void 0===t||null===(a=t.response)||void 0===a?void 0:a.data[0])}))},publish:function(){var t=this;this.post.post_content?(this.post.post_meta=this.imgs,this.processing=!0,this.post.post_excerpt=this.post.post_content.slice(0,200),g(this.post).then((function(e){var a,i,n=e.data.data;t.$emit("update",d(d({},n),{},{author_info:{user_avatar:null===(a=t.user)||void 0===a?void 0:a.avatar_origin,display_name:null===(i=t.user)||void 0===i?void 0:i.name}})),t.$notify.success({title:"消息",message:"反馈提交成功"}),t.post=t.$options.data().post,t.imgs=[],t.$refs.upload.clearFiles()})).catch((function(e){t.$notify.error({title:"消息",message:"反馈提交失败"})})).finally((function(){t.processing=!1}))):this.$notify.warning({title:"提醒",message:"反馈内容不能为空"})}}},_=v,k=a("2877"),y=Object(k["a"])(_,r,c,!1,null,null,null),w=y.exports,P=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"m-feedback-item"},["single"===t.mode?[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"u-mode-single"},[a("div",{staticClass:"u-feedback-misc"},[a("img",{staticClass:"u-author-avatar",attrs:{src:t._f("showAvatar")(t.author.user_avatar),alt:t.author.display_name}}),a("a",{staticClass:"u-author-name",attrs:{href:t._f("authorLink")(t.post.post_author),target:"_blank"}},[t._v(t._s(t.post.author||"匿名"))]),a("span",{staticClass:"u-feedback-date"},["update"==t.order?a("time",[t._v(t._s(t._f("dateFormat")(t.post.post_modified)))]):a("time",[t._v(t._s(t._f("dateFormat")(t.post.post_date)))])])]),a("div",{staticClass:"u-feedback-content"},[t._v(t._s(t.post.post_content))]),t.images&&t.images.length?a("div",{staticClass:"u-single-imgs"},t._l(t.images,(function(e,i){return a("img",{key:e,attrs:{src:e},on:{click:function(e){return t.handlePreview(i)}}})})),0):t._e(),a("Thx",{staticClass:"m-thx",attrs:{postId:t.feedbackId,postType:"feedback",adminBoxcoinEnable:!1,userBoxcoinEnable:!0}}),a("div",{staticClass:"m-single-comment"},[a("el-divider",{attrs:{"content-position":"left"}},[t._v("评论")]),t.feedbackId?a("Comment",{attrs:{id:t.feedbackId,category:"post"}}):a("el-alert",{attrs:{title:"作者没有开启评论功能",type:"warning","show-icon":""}})],1)],1)]:[a("div",{staticClass:"u-mode-list"},[a("div",{staticClass:"u-feedback-content"},[a("router-link",{attrs:{tag:"div",to:t._f("postLink")(t.data.ID)}},[t._v(t._s(t.data.post_excerpt))])],1),a("div",{staticClass:"u-feedback-misc"},[a("img",{staticClass:"u-author-avatar",attrs:{src:t._f("showAvatar")(t.data.author_info.user_avatar),alt:t.data.author_info.display_name}}),a("a",{staticClass:"u-author-name",attrs:{href:t._f("authorLink")(t.data.post_author),target:"_blank"}},[t._v(t._s(t.data.author_info.display_name))]),a("span",{staticClass:"u-feedback-date"},["update"==t.order?a("time",[t._v(t._s(t._f("dateFormat")(t.data.post_modified)))]):a("time",[t._v(t._s(t._f("dateFormat")(t.data.post_date)))])]),t.isListPage?a("span",{staticClass:"like",class:{disabled:!t.isLike,on:!t.isLike},attrs:{title:"点赞"},on:{click:t.addLike}},[a("i",{staticClass:"like-icon"},[t._v(t._s(t.isLike?"♡":"♥"))]),t.count?a("span",{staticClass:"like-count"},[t._v(t._s(t.count))]):t._e()]):t._e()]),a("i",{directives:[{name:"show",rawName:"v-show",value:t.isEditor,expression:"isEditor"}],staticClass:"el-icon-close u-feedback-delete",attrs:{title:"删除"},on:{click:function(e){return e.stopPropagation(),t.delFeedback.apply(null,arguments)}}})])]],2)},C=[],O=(a("a9e3"),a("fb92")),j=a("85e4"),x=a("9616"),$=a("3a4b"),L=a("29c2"),I=a("23d8"),D={name:"feedbackItem",props:{data:{type:Object,default:function(){}},order:{type:String,default:""},mode:{type:String,default:"list"},feedbackId:{type:[String,Number],defalut:0}},data:function(){return{isLike:!0,count:0,post:{},author:{},loading:!1}},computed:{images:function(){var t;return(null===(t=this.post)||void 0===t?void 0:t.post_meta)||[]},isListPage:function(){return"single"!=this.mode},isEditor:function(){return f["a"].isEditor()}},watch:{data:{deep:!0,immediate:!0,handler:function(t){t&&(this.count=t.count||0)}},feedbackId:{immediate:!0,handler:function(t){"single"===this.mode&&this.init()}}},filters:{dateFormat:function(t){return Object(O["b"])(new Date(t))},showAvatar:function(t){return Object(j["showAvatar"])(t)},authorLink:function(t){return Object(j["authorLink"])(t)},postLink:function(t){return"/feedback/"+t}},methods:{handlePreview:function(t){this.$hevueImgPreview({multiple:!0,nowImgIndex:t,imgList:this.images,controlBar:!1,clickMaskCLose:!0})},addLike:function(){if(this.isLike){var t;if(this.count++,this.isLike)Object(x["b"])("feedback",null===(t=this.data)||void 0===t?void 0:t.ID,"likes");this.isLike=!1}},loadPost:function(){var t=this;this.loading=!0,Object(L["b"])(this.feedbackId,this).then((function(e){t.post=e.data.data,t.loadAuthor()})).finally((function(){t.loading=!1}))},loadAuthor:function(){var t,e=this;Object($["a"])(null===(t=this.post)||void 0===t?void 0:t.post_author).then((function(t){e.author=t.data.data}))},delFeedback:function(){var t=this;this.$confirm("此操作将会删除该反馈，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(L["d"])(t.data.ID).then((function(){t.$notify({title:"成功",message:"删除成功",type:"success"}),t.$emit("update",t.data.ID)})).catch((function(e){t.$notify({title:"错误",message:(null===e||void 0===e?void 0:e.message)||"删除失败，请重试或者联系管理员",type:"error"})}))}))},init:function(){this.loadPost()}},components:{Comment:I["a"]}},E=D,F=(a("8d4b"),Object(k["a"])(E,P,C,!1,null,null,null)),B=F.exports,A=a("1647"),M=(a("2ef0"),{name:"Feedback",props:[],data:function(){return{loading:!1,data:[],page:1,total:1,pages:1,per:10,appendMode:!1,search:"",searchType:"title",order:"update",mark:"",client:this.$store.state.client,feedback_url:p["feedback"]}},computed:{id:function(){return this.$route.params.id},resetParams:function(){return[this.subtype,this.search,this.mark,this.client]},params:function(){var t=this,e={per:this.per,page:~~this.page||1,sticky:1,type:"feedback"},a=["search","order","mark","client"];return a.forEach((function(a){t[a]&&(e[a]=t[a])})),e},target:function(){return Object(j["buildTarget"])()},defaultBanner:function(){return p["__imgPath"]+"image/banner/null.png"},publish_link:function(t){return Object(j["publishLink"])("bbs")}},methods:{loadPosts:function(){var t=this;this.loading=!0,Object(L["c"])(this.params,this).then((function(e){t.appendMode?t.data=t.data.concat(e.data.data.list):t.data=e.data.data.list,t.total=e.data.data.total,t.pages=e.data.data.pages})).finally((function(){t.appendMode=!1,t.loading=!1}))},changePage:function(t){this.appendMode=!1,this.page=t,window.scrollTo(0,0)},appendPage:function(t){this.appendMode=!0,this.page=t},filter:function(t){this.appendMode=!1,this[t["type"]]=t["val"]},showBanner:function(t,e){return t?Object(j["showBanner"])(t):p["__imgPath"]+"image/banner/bbs"+e+".png?v=1"},handleFeedbackUpdate:function(t){this.data=[t].concat(Object(s["a"])(this.data))},loadLike:function(){var t=this,e=this.data.map((function(t){return"feedback-"+t.ID}));e=e.join(",");var a={post_type:"feedback",post_action:"likes",id:e};Object(L["a"])(a).then((function(e){var a=e.data.data;Object.keys(a).length&&t.data.forEach((function(e){var i;t.$set(e,"count",null===a||void 0===a||null===(i=a["feedback-"+e.ID])||void 0===i?void 0:i.likes)}))}))},goBack:function(){this.$router.push("/feedback")},handleUpdate:function(t){this.data=this.data.filter((function(e){return e.ID!==t}))}},filters:{dateFormat:function(t){return Object(O["a"])(new Date(t))},showAvatar:function(t){return Object(j["showAvatar"])(t)},isHighlight:function(t){return t?"color:".concat(t,";font-weight:600;"):""},showMark:function(t){return A["a"][t]},markcls:function(t){return"u-mark-"+t}},watch:{subtype:function(){this.search=""},params:{deep:!0,immediate:!0,handler:function(t){this.loadPosts()}},"$route.query.page":function(t){this.page=~~t},data:{deep:!0,handler:function(){this.loadLike()}}},created:function(){this.page=~~this.$route.query.page||1},components:{listbox:o["a"],"publish-feedback":w,feedbackItem:B}}),N=M,T=(a("31a9"),Object(k["a"])(N,i,n,!1,null,null,null));e["default"]=T.exports},"735f":function(t,e,a){"use strict";a("2f56")},8423:function(t,e,a){},"8d4b":function(t,e,a){"use strict";a("8423")},a0dd:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"m-archive-box"},[t._t("search-before"),t.$slots.filter?a("div",{staticClass:"m-archive-filter"},[t._t("filter")],2):t._e(),t._t("search-after"),t._t("default"),t.list.length?t._e():a("el-alert",{staticClass:"m-archive-null",attrs:{title:"没有找到相关条目",type:"info",center:"","show-icon":""}}),a("el-button",{staticClass:"m-archive-more",class:{show:t.hasNextPage},attrs:{type:"primary"},on:{click:t.appendPage}},[t._v("加载更多")]),a("el-pagination",{staticClass:"m-archive-pages",attrs:{background:"",layout:"total, prev, pager, next,jumper","hide-on-single-page":!0,"page-size":t.perPage,total:t.totalRecords,"current-page":t.currentPage},on:{"update:currentPage":function(e){t.currentPage=e},"update:current-page":function(e){t.currentPage=e},"current-change":t.changePage}})],2)},n=[],s={name:"cms-list",props:["data","total","per","pages","page"],data:function(){return{currentPage:this.page||1}},computed:{list:function(){return this.data},totalRecords:function(){return this.total},totalPages:function(){return this.pages},perPage:function(){return this.per},hasNextPage:function(){return this.totalRecords>1&&this.currentPage<this.totalPages}},methods:{appendPage:function(){this.$emit("appendPage",++this.currentPage)},changePage:function(t){this.$emit("changePage",t),this.$route.query.page=t}},watch:{page:function(t){this.currentPage=t}},mounted:function(){},components:{}},o=s,r=(a("735f"),a("2877")),c=Object(r["a"])(o,i,n,!1,null,null,null);e["a"]=c.exports},a5b9:function(t,e,a){},dbb4:function(t,e,a){var i=a("23e7"),n=a("83ab"),s=a("56ef"),o=a("fc6a"),r=a("06cf"),c=a("8418");i({target:"Object",stat:!0,sham:!n},{getOwnPropertyDescriptors:function(t){var e,a,i=o(t),n=r.f,l=s(i),u={},d=0;while(l.length>d)a=n(i,e=l[d++]),void 0!==a&&c(u,e,a);return u}})},e439:function(t,e,a){var i=a("23e7"),n=a("d039"),s=a("fc6a"),o=a("06cf").f,r=a("83ab"),c=n((function(){o(1)})),l=!r||c;i({target:"Object",stat:!0,forced:l,sham:!r},{getOwnPropertyDescriptor:function(t,e){return o(s(t),e)}})}}]);
//# sourceMappingURL=chunk-87a450ea.a1da3986.js.map