(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-32d6f196"],{"33a5":function(t){t.exports=JSON.parse('{"0":"江湖","1":"天策","2":"万花","3":"纯阳","4":"七秀","5":"少林","6":"藏剑","7":"丐帮","8":"明教","9":"五毒","10":"唐门","18":"苍云","19":"长歌","20":"霸刀","21":"蓬莱","22":"凌雪","23":"衍天","24":"药宗"}')},"9aa3":function(t,e,i){"use strict";i("b8fc")},a15b:function(t,e,i){"use strict";var a=i("23e7"),n=i("e330"),o=i("44ad"),s=i("fc6a"),r=i("a640"),l=n([].join),c=o!=Object,u=r("join",",");a({target:"Array",proto:!0,forced:c||!u},{join:function(t){return l(s(this),void 0===t?",":t)}})},a190:function(t,e,i){"use strict";i("d90d")},a27f:function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var a=i("41cb");function n(t){return Object(a["d"])().get("/api/summary/batch",{params:t})}},ae78:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"v-emotion"},[t.id?i("div",{staticClass:"m-emotion-single-container"},[i("div",{staticClass:"m-emotion-goback"},[i("el-button",{staticClass:"u-back",attrs:{size:"mini",icon:"el-icon-arrow-left"},on:{click:t.goBack}},[t._v("返回列表")])],1),i("emotion-item",{attrs:{emotion:t.emotion,mode:"single"}}),i("Thx",{staticClass:"m-thx",attrs:{postId:t.id,postType:"emotion",userId:t.user_id,adminBoxcoinEnable:!0,userBoxcoinEnable:!0}}),i("div",{staticClass:"m-single-comment"},[i("el-divider",{attrs:{"content-position":"left"}},[t._v("评论")]),i("Comment",{attrs:{id:t.id,category:"emotion"}})],1)],1):i("div",{staticClass:"m-emotion-list-container"},[i("div",{staticClass:"m-emotion-search",attrs:{slot:"search-before"},slot:"search-before"},[i("el-input",{attrs:{placeholder:"请输入搜索内容"},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}},[i("span",{attrs:{slot:"prepend"},slot:"prepend"},[t._v("关键词")]),i("el-switch",{attrs:{slot:"append","inactive-value":0,"active-value":1,"inactive-text":"只看精选"},slot:"append",model:{value:t.star,callback:function(e){t.star=e},expression:"star"}})],1)],1),i("div",{staticClass:"m-emotion-types"},[i("el-tabs",{model:{value:t.type,callback:function(e){t.type=e},expression:"type"}},[i("el-tab-pane",{attrs:{name:"all",label:"全部"}},[i("span",{attrs:{slot:"label"},slot:"label"},[i("i",{staticClass:"u-icon el-icon-menu",staticStyle:{"vertical-align":"0"}}),t._v("全部 ")])]),t._l(t.schoolmap,(function(e,a){return i("el-tab-pane",{key:a,attrs:{name:a}},[i("div",{staticStyle:{"min-width":"57px"},attrs:{slot:"label"},slot:"label"},[i("img",{staticClass:"u-icon",attrs:{src:t._f("showSchoolIcon")(a),alt:e}}),t._v(" "+t._s(e)+" ")])])}))],2)],1),i("emotion-post",{attrs:{type:t.type}}),t.list&&t.list.length?i("ul",{staticClass:"m-emotion-list"},t._l(t.list,(function(e,a){return i("li",{key:e.id,staticClass:"u-item"},[i("emotion-item",{attrs:{emotion:e,index:a},on:{preview:t.handlePreview}})],1)})),0):i("el-alert",{attrs:{title:"没有找到相关条目",type:"info","show-icon":""}}),i("el-button",{directives:[{name:"show",rawName:"v-show",value:t.page<t.pages,expression:"page < pages"}],staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:t.loadMore}},[t._v("加载更多")]),i("el-pagination",{staticClass:"m-emotion-pagination",attrs:{background:"","page-size":t.per,"hide-on-single-page":!0,"current-page":t.page,layout:"total, prev, pager, next, jumper",total:t.total},on:{"update:currentPage":function(e){t.page=e},"update:current-page":function(e){t.page=e},"current-change":t.skipTop}})],1)])},n=[];function o(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}i("ac1f"),i("841c"),i("d81d"),i("d3b7"),i("99af"),i("a15b"),i("b64b"),i("159b");var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"m-emotion-item",class:{single:"single"===t.mode}},["single"===t.mode?[i("img",{staticClass:"m-single-img",attrs:{src:t.emotionUrl(t.emotion.url),alt:""},on:{click:t.preview}}),i("div",[t._v(t._s(t.emotion.desc))]),i("el-radio-group",{staticClass:"u-image-type",attrs:{size:"small"},model:{value:t.imgType,callback:function(e){t.imgType=e},expression:"imgType"}},[i("el-radio-button",{attrs:{label:"png"}},[t._v("PNG")]),i("el-radio-button",{attrs:{label:"gif"}},[t._v("GIF")])],1)]:[i("div",{staticClass:"u-emotion"},[i("i",{staticClass:"u-img",on:{click:t.preview}},[t.emotion.original?i("i",{staticClass:"u-original"},[t._v("原创")]):t._e(),i("img",{staticClass:"u-pic u-emotion-pic",attrs:{src:t.emotion.url,alt:""}})])]),i("div",{staticClass:"u-desc"},[i("span",{staticClass:"u-edit el-link el-link--primary is-underline",attrs:{title:"编辑"},on:{click:t.handleContent}},[t._v(" "+t._s(t.emotion.desc)+" ")])]),i("div",{staticClass:"u-op"},[i("span",{staticClass:"u-user"},[i("img",{attrs:{alt:"avatar",width:"24",height:"24",src:t._f("showAvatar")(t.user_avatar)}}),t.emotion.user_id?i("a",{attrs:{href:t._f("authorLink")(t.emotion.user_id),target:"_blank"}},[t._v(t._s(t.user_name))]):i("span",[t._v(t._s(t.emotion.author||"匿名"))])]),i("span",[i("i",{staticClass:"u-op-hot",attrs:{title:"点赞"},on:{click:t.addLike}},[t._v("♥")]),t.isEditor?i("i",{staticClass:"u-op-star",class:{on:t.isStar},attrs:{title:t.isStar?"取消加精":"设为精选"},on:{click:t.handleStar}},[t._v("★")]):t._e()])])]],2)},r=[],l=i("85e4"),c=i("9616"),u=i("c9d2"),d=i("41cb");function p(t){return Object(d["b"])().post("/api/cms/post/emotion",t)}var m=function(t){return Object(d["b"])().get("/api/cms/post/emotions",{params:t})};function h(t){return Object(d["b"])().get("/api/cms/post/emotion/".concat(t))}var f=function(t){return Object(d["b"])().put("/api/cms/post/emotion/".concat(t,"/star"))};function v(t){return Object(d["b"])().put("/api/cms/post/emotion/".concat(t,"/unstar"))}function g(t){return Object(d["b"])().post("/api/cms/upload",t)}var b={props:["mode","emotion","index"],name:"emotion_item",data:function(){return{isLike:!1,isStar:this.emotion.star,imgType:"png"}},computed:{user_avatar:function(){var t,e;return null===(t=this.emotion)||void 0===t||null===(e=t.user_info)||void 0===e?void 0:e.user_avatar},user_name:function(){var t,e;return null===(t=this.emotion)||void 0===t||null===(e=t.user_info)||void 0===e?void 0:e.display_name},isEditor:function(){return u["a"].isEditor()}},filters:{showAvatar:function(t){return Object(l["showAvatar"])(t,24)},authorLink:l["authorLink"]},methods:{emotionUrl:function(t){return"png"===this.imgType?this.emotion.url:""},editLink:l["editLink"],preview:function(){"single"===this.mode?this.$hevueImgPreview({url:this.emotion.url,controlBar:!1,clickMaskCLose:!0}):this.$emit("preview",this.index)},addLike:function(){if(!this.isLike){var t;if(this.count++,!this.isLike)Object(c["b"])("emotion",null===(t=this.emotion)||void 0===t?void 0:t.id,"likes");this.isLike=!0}},handleStar:function(){var t=this;this.isStar?this.unStar():f(this.emotion.id).then((function(){t.$notify({title:"成功",message:"加精成功",type:"success"}),t.isStar=!0,t.$forceUpdate()}))},unStar:function(){var t=this;v(this.emotion.id).then((function(){t.$notify({title:"成功",message:"取消加精成功",type:"success"}),t.isStar=!1,t.$forceUpdate()}))},handleContent:function(){this.$router.push("/emotion/".concat(this.emotion.id))}}},y=b,k=i("2877"),_=Object(k["a"])(y,s,r,!1,null,"6f082406",null),w=_.exports,C=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"m-emotion-publish"},[i("div",{staticClass:"m-emotion-upload"},[t.data&&t.data.url?i("div",{staticClass:"u-emotion"},[i("img",{attrs:{src:t.data.url}}),i("i",{staticClass:"u-emotion-mask"}),i("i",{staticClass:"u-emotion-delete el-icon-delete",attrs:{title:"移除"},on:{click:t.handleRemove}})]):i("div",{staticClass:"u-upload el-upload el-upload--picture-card",on:{click:t.select}},[i("i",{staticClass:"el-icon-plus"})]),i("input",{ref:"uploadInput",staticClass:"u-upload-input",attrs:{type:"file"},on:{change:t.upload}})]),i("div",{staticClass:"u-emotion-form"},[i("el-input",{staticClass:"u-emotion-desc",attrs:{placeholder:"图片说明"},model:{value:t.data.desc,callback:function(e){t.$set(t.data,"desc",e)},expression:"data.desc"}}),i("div",{staticClass:"m-publish-buttons"},[i("el-button",{attrs:{type:"primary",disabled:t.loading,icon:"el-icon-s-promotion"},on:{click:t.post}},[t._v("提交")])],1)],1)])},O=[];i("a4d3"),i("4de4"),i("e439"),i("dbb4");function j(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,a)}return i}function x(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?j(Object(i),!0).forEach((function(e){o(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):j(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}i("b0c0");var S,P={name:"emotion_post",props:["type"],data:function(){return{data:{url:"",desc:"",original:0,author:""},loading:!1}},computed:{fileInput:function(){return this.$refs.uploadInput}},methods:{select:function(){this.fileInput.dispatchEvent(new MouseEvent("click"))},upload:function(){var t=this,e=new FormData;e.append("file",this.fileInput.files[0]),console.log(this.fileInput.files[0]),g(e).then((function(e){var i;t.data.url=e.data.data[0],t.data.desc=(null===(i=t.fileInput.files[0])||void 0===i?void 0:i.name)||"无描述",t.$message({message:"上传成功",type:"success"})}))},handleRemove:function(){this.data.url="",this.data.desc=""},post:function(){var t=this;this.loading=!0,p(x(x({},this.data),{},{type:"all"===this.type?"":this.type})).then((function(){t.$message({type:"success",message:"表情发布成功"}),t.fileInput.value="",t.data=t.$options.data().data})).finally((function(){t.loading=!1}))}}},$=P,I=(i("9aa3"),Object(k["a"])($,C,O,!1,null,"59937178",null)),L=I.exports,E=i("23d8"),T=i("33a5"),M=i("65c2"),D=i("a27f"),B=(S={name:"Emotion",components:{"emotion-item":w,Comment:E["a"]},data:function(){return{loading:!1,schoolmap:T,type:"all",star:0,search:"",per:24,page:1,pages:1,total:0,emotions:[],list:[],appendMode:!1,emotion:""}},computed:{id:function(){return~~this.$route.params.id},params:function(t){var e=t.search,i=t.per,a=t.page,n=t.star;return{per:i,page:a,type:"all"==this.type?"":this.type,search:e,star:n}},keys:function(){return[this.search,this.page,this.per,this.type,this.id,this.star,this.type]},user_id:function(){var t;return(null===(t=this.emotion)||void 0===t?void 0:t.user_id)||0},images:function(){return this.list.map((function(t){return t.url}))}},filters:{showSchoolIcon:function(t){return M["__imgPath"]+"image/school/"+t+".png"}},methods:{loadList:function(){var t=this;this.loading=!0,m(this.params).then((function(e){var i,a,n,o,s,r;t.appendMode?(t.list=t.list.concat((null===(i=e.data)||void 0===i||null===(a=i.data)||void 0===a?void 0:a.list)||[]),t.emotions=(null===(n=e.data)||void 0===n||null===(o=n.data)||void 0===o?void 0:o.list)||[]):t.list=t.emotions=(null===(s=e.data)||void 0===s||null===(r=s.data)||void 0===r?void 0:r.list)||[];t.total=e.data.data.total,t.pages=e.data.data.pages})).finally((function(){t.loading=!1}))},loadSingle:function(){var t=this;this.loading=!0,h(this.id).then((function(e){var i;t.emotion=null===e||void 0===e||null===(i=e.data)||void 0===i?void 0:i.data})).finally((function(){t.loading=!1}))},loadMore:function(){this.appendMode=!0,this.page++},init:function(){this.id?this.loadSingle():this.loadList()},handlePreview:function(t){this.$hevueImgPreview({multiple:!0,nowImgIndex:t,imgList:this.images,controlBar:!1,clickMaskCLose:!0})},goBack:function(){this.$router.push("/emotion")},skipTop:function(){window.scrollTo(0,0)},loadLike:function(){var t=this,e=this.emotions.map((function(t){return"emotion-"+t.id}));e=e.join(",");var i={post_type:"emotion",post_action:"likes",id:"emotion-"+e};Object(D["a"])(i).then((function(e){var i=e.data.data;Object.keys(i).length&&t.emotions.forEach((function(e){var a;t.$set(e,"count",null===i||void 0===i||null===(a=i["emotion-"+e.id])||void 0===a?void 0:a.likes)}))}))}},watch:{keys:{deep:!0,handler:function(){this.init()}},emotions:{deep:!0,handler:function(){this.loadLike()}}},mounted:function(){this.init()}},o(S,"filters",{showSchoolIcon:function(t){return M["__imgPath"]+"image/school/"+t+".png"}}),o(S,"components",{"emotion-item":w,"emotion-post":L,Comment:E["a"]}),S),A=B,N=(i("a190"),Object(k["a"])(A,a,n,!1,null,null,null));e["default"]=N.exports},b8fc:function(t,e,i){},d90d:function(t,e,i){},dbb4:function(t,e,i){var a=i("23e7"),n=i("83ab"),o=i("56ef"),s=i("fc6a"),r=i("06cf"),l=i("8418");a({target:"Object",stat:!0,sham:!n},{getOwnPropertyDescriptors:function(t){var e,i,a=s(t),n=r.f,c=o(a),u={},d=0;while(c.length>d)i=n(a,e=c[d++]),void 0!==i&&l(u,e,i);return u}})},e439:function(t,e,i){var a=i("23e7"),n=i("d039"),o=i("fc6a"),s=i("06cf").f,r=i("83ab"),l=n((function(){s(1)})),c=!r||l;a({target:"Object",stat:!0,forced:c,sham:!r},{getOwnPropertyDescriptor:function(t,e){return s(o(t),e)}})}}]);
//# sourceMappingURL=chunk-32d6f196.1c67a7cc.js.map