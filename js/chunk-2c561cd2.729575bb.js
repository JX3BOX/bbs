(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2c561cd2"],{"02aa":function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t._self._c;return e("CommunitySingleLayout",{attrs:{post:t.post}},[e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"m-community-single"},[e("div",{staticClass:"m-community-header"},[e("PostHeader",{attrs:{post:t.post,stat:t.stat},scopedSlots:t._u([{key:"append",fn:function(){return[e("el-pagination",{staticClass:"m-pageheader-pagination",attrs:{layout:"prev, pager, next","hide-on-single-page":!0,"page-size":t.per,total:t.total,"current-page":t.page,size:"small"},on:{"update:currentPage":function(e){t.page=e},"update:current-page":function(e){t.page=e},"current-change":t.changePage}})]},proxy:!0}])}),e("el-divider",{attrs:{"content-position":"left"}},[t._v("JX3BOX")])],1),e("div",{staticClass:"m-list-box"},[e("div",{staticClass:"m-master-box"},[1===this.page?e("ReplyItem",{attrs:{isMaster:!0,post:t.post}}):t._e()],1),e("div",{staticClass:"m-reply-box"},t._l(t.replyList,(function(i,n){return e("ReplyItem",{key:n,attrs:{post:i,"is-master":!1,"is-author":t.isAuthor}})})),1)]),e("div",{staticClass:"m-community-footer"},[e("div",{staticClass:"m-pagination-box"},[e("el-pagination",{attrs:{background:"",layout:"total, prev, pager, next, jumper","hide-on-single-page":!0,"page-size":t.per,total:t.total,"current-page":t.page},on:{"update:currentPage":function(e){t.page=e},"update:current-page":function(e){t.page=e},"current-change":t.changePage}})],1),e("el-divider",{attrs:{"content-position":"left"}},[t._v("回帖")]),e("div",{staticClass:"u-editor"},[e("CommentEditor",{on:{submit:t.onReplyTopic}})],1)],1)])])},s=[],o=i("c7eb"),a=i("5530"),r=i("1da1"),c=(i("7db0"),i("caad"),i("a15b"),i("d81d"),i("14d9"),i("b0c0"),i("a9e3"),i("b64b"),i("d3b7"),i("2532"),function(){var t=this,e=t._self._c;return e("div",{staticClass:"m-reply-wrapper",attrs:{id:"floor-".concat(t.post.floor)}},[e("div",{staticClass:"m-reply-left"},[e("CommentUser",{attrs:{uid:t.userInfo.id}}),e("div",{staticClass:"u-top-right u-mobile-show"},[e("div",[e("div",{staticClass:"u-floor"},[t._v(t._s(t.isMaster?"楼主":"#"+t.post.floor))]),e("div",{staticClass:"m-reply-time"},[t._v(t._s(t.showTime))])])])],1),e("div",{staticClass:"m-reply-right"},[e("div",{staticClass:"m-reply-content"},[e("div",{staticClass:"u-reply-floor u-mobile-hidden"},[t._v(" "+t._s(t.isMaster?"楼主":t.post.floor+"楼")+" ")]),e("div",{staticClass:"u-reply-content"},[t.isMaster?e("Article",{attrs:{content:t.post.content||""}}):e("div",{domProps:{innerHTML:t._s(t.renderContent)}})],1),t.isMaster?e("Thx",{staticClass:"m-single-thx",attrs:{postId:t.id,postType:"community_topic",postTitle:t.post.title,userId:t.post.user_id,adminBoxcoinEnable:!0,userBoxcoinEnable:!0,client:t.post.client}}):t._e(),e("div",{staticClass:"m-reply-time u-mobile-hidden"},[t._v(t._s(t.showTime))]),e("div",{staticClass:"u-reply-toolbar"},[e("div",[e("ForwardButton",{staticClass:"u-mobile-hidden",attrs:{post:t.post,isMaster:t.isMaster}}),e("DeleteButton",{staticClass:"u-mobile-hidden",attrs:{post:t.post,type:"reply",isMaster:t.isMaster}}),e("AddBlockButton",{staticClass:"u-mobile-hidden",attrs:{post:t.post}}),e("ComplaintButton",{staticClass:"u-mobile-hidden",attrs:{post:t.post}}),e("el-button",{staticClass:"u-reply-btn",style:t.styles,attrs:{type:"primary",size:"small"},on:{click:function(e){return t.onShowReply()}}},[e("div",{staticClass:"u-btn"},[e("img",{attrs:{src:i("076f"),alt:""}}),e("span",[t._v(t._s(t.isMaster?"跟帖":"回复"))])])]),t.isMaster?t._e():e("el-button",{staticClass:"u-praise-btn",attrs:{disabled:t.isLike,type:"primary",size:"small"},on:{click:t.addLike}},[e("div",{staticClass:"u-btn"},[e("img",{attrs:{src:i("4a11"),alt:""}}),e("span",[t._v("赞")]),e("span",[t._v(t._s(t.likeCountRender))])])])],1),e("div",[e("el-dropdown",{staticClass:"u-more u-mobile-show",attrs:{trigger:"click",placement:"bottom"}},[e("span",{staticClass:"el-dropdown-link"},[e("i",{staticClass:"el-icon-more"})]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("el-dropdown-item",[e("ForwardButton",{staticClass:"u-mobile-hidden",attrs:{post:t.post,isMaster:t.isMaster}})],1),e("el-dropdown-item",[e("DeleteButton",{staticClass:"u-mobile-hidden",attrs:{post:t.post,type:"reply",isMaster:t.isMaster}})],1),e("el-dropdown-item",[e("AddBlockButton",{staticClass:"u-mobile-hidden",attrs:{post:t.post}})],1),e("el-dropdown-item",[e("ComplaintButton",{staticClass:"u-mobile-hidden",attrs:{post:t.post}})],1)],1)],1)],1)]),t.showReplyForReplyFrom?e("ReplyForReply",{attrs:{username:t.userInfo.display_name,"user-href":t.authorLink(t.userId)},on:{hideForm:function(e){t.showReplyForReplyFrom=!1},doReply:t.doReply}}):t._e()],1),!t.isMaster&&t.post.comments_count>3?e("div",{staticClass:"m-comment-collapse"},[t.isCollapse?e("div",{on:{click:t.onCollapseChange}},[e("img",{attrs:{width:"14",src:i("f315"),alt:""}}),e("span",[t._v("折叠评论")])]):e("div",{on:{click:t.onCollapseChange}},[e("img",{attrs:{width:"14",src:i("e59c"),alt:""}}),e("span",[t._v("展开评论")])])]):t._e(),!t.isMaster&&t.commentList.length?e("div",{staticClass:"m-comment-list"},t._l(t.commentList,(function(t){return e("CommentItem",{key:t.id,attrs:{post:t}})})),1):t._e(),t.isCollapse?e("div",{staticClass:"m-pagination-box"},[e("el-pagination",{attrs:{background:"",layout:"total, prev, pager, next","hide-on-single-page":!0,"page-size":t.per,total:t.total,"current-page":t.page},on:{"update:currentPage":function(e){t.page=e},"update:current-page":function(e){t.page=e},"current-change":t.changePage}})],1):t._e()])])}),l=[],u=function(){var t=this,e=t._self._c;return e("div",{staticClass:"m-comment-user c-author"},[e("AuthorInfo",{attrs:{uid:t.uid},on:{ready:t.installModules}}),t.data?[e("div",{staticClass:"u-interact"},[e("AuthorFollow",{staticStyle:{"margin-right":"8px"},attrs:{uid:t.uid}}),e("el-button",{staticClass:"u-btn",attrs:{icon:"el-icon-message",size:"mini"},on:{click:t.onMessage}},[t._v("私信")])],1),e("AuthorMedals",{staticClass:"u-block u-trophy",attrs:{uid:t.uid}}),t._t("default")]:t._e()],2)},p=[],d=i("af4b"),h=i("16ef"),m=i("6b7e"),f={props:["uid"],data:function(){return{data:""}},methods:{installModules:function(t){this.data=t},onMessage:function(){window.open("/dashboard/letter?receiver="+this.uid,"_blank")}},components:{AuthorInfo:d["a"],AuthorFollow:h["a"],AuthorMedals:m["a"]}},v=f,g=(i("09fb"),i("2877")),y=Object(g["a"])(v,u,p,!1,null,null,null),b=y.exports,_=function(){var t=this,e=t._self._c;return e("el-form",{ref:"form",staticClass:"c-comment-subbox m-comment-editor"},[e("div",{staticClass:"u-subbox-label"},[t._v(" 回复 "),e("el-link",{attrs:{type:"primary",target:"_blank",href:t.userHref}},[t._v("＠"+t._s(t.username))]),t._v(" ： ")],1),e("el-form-item",[e("el-input",{attrs:{type:"textarea",id:"id"+t.inputId,placeholder:"输入回复..."},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}})],1),e("el-form-item",[e("div",{staticClass:"c-comment-tools"},[e("Emotion",{staticClass:"c-comment-emotion",attrs:{type:"pop",max:6},on:{selected:t.handleEmotionSelected}}),e("el-button",{staticClass:"u-publish",attrs:{size:"mini",type:"primary",disabled:t.disableSubmitBtn},on:{click:function(e){return t.submintReply()}}},[t._v("提交")]),e("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(e){return t.hideForm()}}},[t._v("收起")])],1)])],1)},w=[],C=i("c840"),k={props:["username","userHref","currentId"],data:function(){return{content:"",showUploader:!1,disableSubmitBtn:!1,inputId:""}},components:{Emotion:C["a"]},mounted:function(){this.currentId&&(this.inputId=this.currentId)},methods:{submintReply:function(){this.disableSubmitBtn=!0,this.$refs.uploader?this.$refs.uploader.upload():this.attachmentUploadFinish([])},hideForm:function(){this.$emit("hideForm")},attachmentUploadFinish:function(t){this.disableSubmitBtn=!1,this.$emit("doReply",{content:this.content,attachmentList:t}),this.content="",this.showUploader=!1},attachmentUplodError:function(){this.disableSubmitBtn=!1},handleEmotionSelected:function(t){var e=this;return Object(r["a"])(Object(o["a"])().mark((function i(){var n,s,a,r;return Object(o["a"])().wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(n=document.querySelector("#id".concat(e.inputId)),s=t.key,!n.selectionStart&&0!==n.selectionStart){i.next=12;break}return a=n.selectionStart,r=n.selectionEnd,e.content=n.value.substring(0,a)+s+n.value.substring(r,n.value.length),i.next=8,e.$nextTick();case 8:n.focus(),n.setSelectionRange(r+s.length,r+s.length),i.next=13;break;case 12:e.content=s;case 13:case"end":return i.stop()}}),i)})))()}}},x=k,L=(i("2ed4"),Object(g["a"])(x,_,w,!1,null,null,null)),R=L.exports,j=function(){var t=this,e=t._self._c;return e("div",{staticClass:"m-comment-wrapper"},[e("div",{staticClass:"m-comment-right"},[e("img",{staticClass:"u-avatar",attrs:{src:t.showAvatar(t.userInfo.avatar)}}),e("div",{staticClass:"m-comment-content"},[e("div",{staticClass:"u-content-top"},[e("div",{staticClass:"u-name"},[e("a",{attrs:{href:t.authorLink(t.userInfo.id),alt:"用户名"}},[t._v(t._s(t.userInfo.display_name))]),e("span",{staticClass:"m-comment-time u-mobile-show"},[t._v(t._s(t.post.updated_at))])]),e("div",[e("el-dropdown",{staticClass:"u-more u-mobile-show",attrs:{trigger:"click",placement:"bottom"}},[e("span",{staticClass:"el-dropdown-link"},[e("i",{staticClass:"el-icon-more"})]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("el-dropdown-item",[e("DeleteButton",{attrs:{post:t.post,type:"comment"}})],1),e("el-dropdown-item",[e("AddBlockButton",{attrs:{post:t.post}})],1),e("el-dropdown-item",[e("ComplaintButton",{attrs:{post:t.post}})],1)],1)],1)],1)]),e("p",{staticClass:"u-answer-user"},[t._v("回复 "+t._s(t.replyUserInfo.display_name)+"：")]),e("p",{staticClass:"u-content",domProps:{innerHTML:t._s(t.renderContent)}}),e("div",{staticClass:"u-comment-toolbar"},[e("div",[e("el-button",{attrs:{type:"text",size:"small"},on:{click:t.addLike}},[e("div",{staticClass:"u-btn-content"},[e("i",{class:"u-like-icon ".concat(t.isLike&&"is-like")},[t._v(t._s(t.isLike?"♥":"♡"))]),t._v(" "+t._s(t.isLike?"已赞":"赞")+" "),t.likeCount?e("span",{staticClass:"u-count"},[t._v(" ("+t._s(t.likeCountRender)+")")]):t._e()])]),e("el-button",{attrs:{type:"text",size:"small"},on:{click:t.onShowReply}},[e("i",{staticClass:"el-icon-chat-round"}),e("span",[t._v("回复")])])],1),e("div",{staticClass:"u-mobile-hidden"},[e("DeleteButton",{attrs:{post:t.post,type:"comment"}}),e("AddBlockButton",{attrs:{post:t.post}}),e("ComplaintButton",{attrs:{post:t.post}}),e("span",{staticClass:"m-comment-time u-mobile-hidden"},[t._v(t._s(t.post.updated_at))])],1)]),t.showReplyForReplyFrom?e("ReplyForReply",{attrs:{username:t.userInfo.display_name,"user-href":t.authorLink(t.userInfo.id)},on:{hideForm:function(e){t.showReplyForReplyFrom=!1},doReply:t.doReply}}):t._e()],1)])])},O=[],T=i("85e4"),B=i("506c"),M=i("81fc"),F=i("9616"),S=function(){var t=this,e=t._self._c;return e("el-button",{attrs:{type:"text",disabled:!t.allowBlock},on:{click:function(e){return t.addBlock()}}},[e("i",{staticClass:"el-icon-circle-close"}),t._v(" 拉黑 ")])},A=[],I=i("c9d2"),$={name:"add-block-button",props:["post"],computed:{isLogin:function(){return I["a"].isLogin()},allowBlock:function(){return this.isLogin&&this.post.user_id!=I["a"].getInfo().uid}},methods:{addBlock:function(){var t=this;this.$confirm("确定要拉黑此人？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(M["a"])(t.post.user_id).then((function(){t.$message.success("拉黑成功")})).catch((function(t){console.log(t)}))})).catch((function(t){}))}}},z=$,D=Object(g["a"])(z,S,A,!1,null,"87e5968e",null),E=D.exports,H=function(){var t=this,e=t._self._c;return e("el-button",{attrs:{type:"text",disabled:!t.allowReport},on:{click:t.onMiscfeedback}},[e("i",{staticClass:"el-icon-warning-outline"}),t._v(" 举报 ")])},P=[],U=(i("99af"),{name:"ComplaintButton",props:["post"],inject:["getTopicData","getReplyData"],computed:{isLogin:function(){return I["a"].isLogin()},allowReport:function(){return this.isLogin&&this.post.user_id!=I["a"].getInfo().uid}},methods:{onMiscfeedback:function(){var t=this,e=this.getTopicData(),i=this.getReplyData(),n=this.post.user_info||this.post.ext_user_info,s=n.display_name,o=i.floor||0,a=o?o+"楼":"楼主";this.$prompt("请输入要举报的内容","提示",{confirmButtonText:"确定",cancelButtonText:"取消",input:"textarea",inputPlaceholder:"请输入要举报的内容",inputValidator:function(t){if(!t)return"内容不能为空!"}}).then((function(i){var n=i.value,r="魔盒论坛《".concat(e.title,"》").concat(a,"的").concat(s,"：").concat(n);Object(M["f"])({client:e.client,content:r,public:0,subtype:"3",type:"1",refer:"/community/".concat(e.id,"#").concat(o)}).then((function(){t.$message.success("举报成功")}))}))}}}),V=U,q=Object(g["a"])(V,H,P,!1,null,"738d2bf8",null),N=q.exports,J=function(){var t=this,e=t._self._c;return t.canDelete?e("el-button",{attrs:{type:"text"},on:{click:t.onDeleteClick}},[e("i",{staticClass:"el-icon-delete"}),t._v(" 删除 ")]):t._e()},Q=[],Y={name:"DeleteButton",inject:["getTopicData","getReplyList","getReplyData","getCommentList","onSearch"],props:["isMaster","post","type"],computed:{topicData:function(){return this.getTopicData()},replyData:function(){return this.getReplyData()},isAuthor:function(){return this.post.user_id==I["a"].getInfo().uid},isReplyToMyTopic:function(){return"reply"===this.type&&this.topicData.user_id==I["a"].getInfo().uid},isCommentToMyReply:function(){return"comment"===this.type&&this.replyData.user_id==I["a"].getInfo().uid},isSuperAdmin:function(){return I["a"].isSuperAdmin()},isFollower:function(){var t,e;return(null===(t=this.post)||void 0===t?void 0:t.user_id)==(null===(e=I["a"].getInfo())||void 0===e?void 0:e.uid)},canDelete:function(){return!this.isMaster&&(this.isSuperAdmin||this.isFollower)}},methods:{onDeleteClick:function(){this.isAuthor||this.isSuperAdmin?"comment"===this.type?this.isSuperAdmin?this.manageDeleteComment():this.delMyComment():"reply"===this.type?this.isSuperAdmin?this.manageDeleteReply():this.deleteMyReply():this.$message.success("未知的组件类型："+this.type):(this.isReplyToMyTopic&&this.delReplyToMyTopic(),this.isCommentToMyReply&&this.delCommentToMyReply())},deleteMyReply:function(){var t=this;this.$confirm("确认是否删除该回帖？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(M["e"])(t.post.id).then((function(){t.$message.success("删除成功"),t.onSearch()}))}))},delMyComment:function(){var t=this;this.$confirm("确认是否删除该评论？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(M["c"])(t.post.id).then((function(){t.$message.success("删除成功"),t.getCommentList({index:1})}))}))},delReplyToMyTopic:function(){var t=this;this.$confirm("确认是否删除该回帖？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(M["d"])(t.topicData.id,t.post.id).then((function(){t.$message.success("删除成功"),t.onSearch()}))}))},delCommentToMyReply:function(){var t=this;this.$confirm("确认是否删除该评论？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(M["b"])(t.post.topic_reply_id,t.post.id).then((function(){t.$message.success("删除成功"),t.getCommentList({index:1})}))}))},manageDeleteComment:function(){var t=this;this.$confirm("确认是否删除该评论？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(M["m"])(t.post.id).then((function(){t.$message.success("删除成功"),t.getCommentList({index:1})}))}))},manageDeleteReply:function(){var t=this;this.$confirm("确认是否删除该回帖？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(M["n"])(t.post.id).then((function(){t.$message.success("删除成功"),t.onSearch()}))}))}}},W=Y,X=Object(g["a"])(W,J,Q,!1,null,"537e8ca6",null),G=X.exports,K={name:"CommentItem",props:["post"],inject:["getTopicData","getReplyData","getCommentList"],components:{ReplyForReply:R,AddBlockButton:E,ComplaintButton:N,DeleteButton:G},data:function(){return{isLike:!1,likeCount:0,renderContent:"",showReplyForReplyFrom:!1,commentList:[]}},watch:{content:{handler:function(t){this.formatContent(t)},immediate:!0},"post.likes":{handler:function(t){this.likeCount=t},immediate:!0}},computed:{likeCountRender:function(){return this.likeCount>=100?"99+":0!=this.likeCount?this.likeCount:""},userInfo:function(){return this.post.user_info},replyUserInfo:function(){return this.post.reply_for_user_info},comments:function(){return this.post.comments},content:function(){return this.post.content},id:function(){return this.post.id}},mounted:function(){},methods:{authorLink:T["authorLink"],formatContent:function(t){var e=this;return Object(r["a"])(Object(o["a"])().mark((function i(){var n;return Object(o["a"])().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return n=new B["a"](t),i.next=3,n._renderHTML();case 3:e.renderContent=i.sent;case 4:case"end":return i.stop()}}),i)})))()},onShowReply:function(){this.showReplyForReplyFrom=!this.showReplyForReplyFrom},doReply:function(t){var e=this,i=t.content,n=this.$route.params.id,s=this.post.topic_reply_id,o=this.userInfo.id;n&&s&&o?Object(M["o"])(n,s,{content:i,reply_for_user_id:o}).then((function(){e.getCommentList()})).finally((function(){e.showReplyForReplyFrom=!1})):this.$message.error("回复失败：数据不正确"),this.showReplyForReplyFrom=!1},addLike:function(){this.isLike||(this.likeCount++,this.isLike||Object(F["b"])("community_comment",this.post.id,"likes"),this.isLike=!0)},showAvatar:T["showAvatar"]}},Z=K,tt=(i("423c"),Object(g["a"])(Z,j,O,!1,null,null,null)),et=tt.exports,it=i("a974"),nt=function(){var t=this,e=t._self._c;return t.allowForward?e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.onForward()}}},[e("i",{staticClass:"el-icon-document-copy"}),e("span",{staticClass:"u-copy-text__pc"},[t._v(" 复制党+1 ")]),e("span",{staticClass:"u-copy-text__phone"},[t._v("  "),e("strong",[t._v("+1")])])]):t._e()},st=[],ot={props:["post","isMaster"],inject:["onReplyTopic"],computed:{isLogin:function(){return I["a"].isLogin()},allowForward:function(){return!this.isMaster&&this.isLogin}},methods:{onForward:function(){this.onReplyTopic({content:this.post.content})}}},at=ot,rt=(i("552d"),Object(g["a"])(at,nt,st,!1,null,"be47b8ce",null)),ct=rt.exports,lt=i("a27f"),ut=(i("2e26"),i("5a0c")),pt=i.n(ut),dt={name:"ReplyItem",inject:["getTopicData","getReplyList","onReplyTopic"],props:["isMaster","post","isAuthor"],components:{DeleteButton:G,ForwardButton:ct,ComplaintButton:N,AddBlockButton:E,CommentUser:b,ReplyForReply:R,CommentItem:et,Article:it["a"]},provide:function(){var t=this;return{getReplyData:function(){return t.post},getCommentList:this.getList}},data:function(){return{page:1,per:5,total:0,isCollapse:!1,isLike:!1,likeCount:0,showReplyForReplyFrom:!1,renderContent:"",commentList:[]}},computed:{showTime:function(){var t=this.post.created_at||this.post.updated_at;return pt()(t).format("YYYY-MM-DD HH:mm:ss")},styles:function(){return this.isMaster?{width:"150px",height:"38px"}:{}},id:function(){return this.$route.params.id},onlyAuthor:function(){var t=this.$route.query.onlyAuthor;return(1==t||"true"==t)&&!0},likeCountRender:function(){return this.likeCount>=100?"99+":0!=this.likeCount?this.likeCount:""},userInfo:function(){return this.post&&this.post.user_info?this.post.user_info:this.post&&this.post.ext_user_info?this.post.ext_user_info:{}},userId:function(){return this.post&&this.post.user_info?this.post.user_info.id:this.post&&this.post.ext_user_info?this.post.ext_user_info.id:""}},watch:{"post.content":{handler:function(t){this.isMaster||this.formatContent(t)},immediate:!0},post:{handler:function(){var t=Object(r["a"])(Object(o["a"])().mark((function t(){return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(this.commentList=[],!this.post.comments){t.next=5;break}return t.next=4,this.getLikes(this.post.comments);case 4:this.commentList=t.sent;case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),immediate:!0},"post.likes":{handler:function(t){this.likeCount=t},immediate:!0}},methods:{onCollapseChange:function(){this.isCollapse?this.commentList=this.post.comments:(this.page=1,this.getList()),this.isCollapse=!this.isCollapse},authorLink:T["authorLink"],formatContent:function(t){var e=this;return Object(r["a"])(Object(o["a"])().mark((function i(){var n;return Object(o["a"])().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return n=new B["a"](t),i.next=3,n._renderHTML();case 3:e.renderContent=i.sent;case 4:case"end":return i.stop()}}),i)})))()},onShowReply:function(){this.isMaster?window.scrollTo(0,document.body.scrollHeight):this.showReplyForReplyFrom=!this.showReplyForReplyFrom},doReply:function(t){var e=this,i=t.content,n=this.$route.params.id,s=this.post.id;n&&s&&this.userId?Object(M["o"])(n,s,{content:i,reply_for_user_id:this.userId}).then((function(){e.getList()})).finally((function(){e.showReplyForReplyFrom=!1})):this.$message.error("回复失败：数据不正确")},changePage:function(){this.getList()},getList:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.isMaster){var i=this.id,n=this.post.id;i&&n&&Object(M["g"])(i,n,Object(a["a"])({index:this.page,pageSize:this.per},e)).then(function(){var e=Object(r["a"])(Object(o["a"])().mark((function e(i){var n;return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=i.data.data.list,!n){e.next=8;break}return e.next=4,t.getLikes(n);case 4:t.commentList=e.sent,t.isCollapse=!0,e.next=9;break;case 8:t.commentList=[];case 9:t.page=i.data.data.page.index,t.total=i.data.data.page.total,t.current=i.data.data.page.current;case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},addLike:function(){this.isLike||(this.likeCount++,this.isLike||(this.isMaster?Object(F["b"])("community_topic",this.post.id,"likes"):Object(F["b"])("community_reply",this.post.id,"likes")),this.isLike=!0)},getLikes:function(t){return Object(r["a"])(Object(o["a"])().mark((function e(){var i,n,s;return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=t.map((function(t){return"community_comment-".concat(t.id)})).join(","),n=[],s={post_type:"community_comment",post_action:"likes",id:i},e.next=5,Object(lt["b"])(s).then((function(e){n=t.map((function(t){var i;return t.likes=(null===(i=e.data.data["community_comment-".concat(t.id)])||void 0===i?void 0:i.likes)||0,t}))})).catch((function(){n=t}));case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})))()}}},ht=dt,mt=(i("66e5"),Object(g["a"])(ht,c,l,!1,null,null,null)),ft=mt.exports,vt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"p-community-single",attrs:{id:"app"}},[e("Header"),t.post?e("Breadcrumb",{attrs:{name:"魔盒论坛",slug:"community",publishEnable:!1,adminEnable:!0,feedbackEnable:!0,crumbEnable:!0,showExtend:!0},scopedSlots:t._u([{key:"op-prepend",fn:function(){return[t.isTeammate?e("AdminDrop",{attrs:{"is-community":!0,post:t.finalPost,"user-id":t.user_id}}):t._e()]},proxy:!0},{key:"title",fn:function(){return[e("span",[t._v(" "+t._s(t.title)+" ")])]},proxy:!0}],null,!1,3373041507)},[e("TopStickyInfo",{attrs:{post:t.post}}),e("publish-gate",{attrs:{slot:"op-append"},slot:"op-append"})],1):t._e(),e("div",[e("Main",{attrs:{withoutRight:!1}},[e("div",{staticClass:"m-community-single__main"},[e("div",{staticClass:"m-community-single__left"},[t._t("default"),e("Footer")],2)])])],1)],1)},gt=[],yt=function(){var t=this,e=t._self._c;return e("transition",{attrs:{name:"slide-fade"}},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],staticClass:"m-sticky-info"},[e("h2",{staticClass:"u-title",style:t.hightStyle},[t._v(t._s(t.title))]),e("div",{staticClass:"u-infos"},[t.isTop?e("span",{staticClass:"u-status u-sub-block top"},[e("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 14 14",fill:"none","svg-inline":"",role:"presentation",focusable:"false",tabindex:"-1"}},[e("path",{attrs:{"fill-rule":"evenodd",fill:"#FFF",d:"M14 1.647H0V0h14v1.647zm-.778 6.405L7 3.294.778 8.052h4.666V14h3.112V8.052h4.666z"}})])]):t._e(),t.isStar?e("span",{staticClass:"u-status u-sub-block star"},[e("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:"15",height:"15",viewBox:"0 0 15 15",fill:"none","svg-inline":"",role:"presentation",focusable:"false",tabindex:"-1"}},[e("path",{attrs:{d:"M15 7.5L9.515 5.485 7.5 0 5.485 5.485 0 7.5l5.485 2.015L7.5 15l2.015-5.485L15 7.5z",fill:"#FFF"}})])]):t._e(),t._l(t.tags,(function(i,n){return e("span",{key:n,staticClass:"u-tag u-meta u-sub-block",style:{backgroundColor:i.color}},[t._v(" "+t._s(i.label)+" ")])})),t.collection?e("a",{staticClass:"u-book u-sub-block u-meta",attrs:{href:t.collection.url,target:"_blank"}},[e("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:"11",height:"16",viewBox:"0 0 11 16",fill:"none","svg-inline":"",role:"presentation",focusable:"false",tabindex:"-1"}},[e("path",{attrs:{"fill-rule":"evenodd",fill:"#A6A6A6",d:"M5.5 12.1L0 16V0h11v16l-5.5-3.9z"}})]),t._v(" "+t._s(t.collection.name)+" ")]):t._e()],2)])])},bt=[],_t={props:["post"],data:function(){return{show:!1}},computed:{hightStyle:function(){return this.post.is_hight&&this.post.hight_color?{color:this.post.hight_color}:{}},collection:function(){return this.post.collection&&this.post.collection.title?{name:this.post.collection.title,url:"/collection/".concat(this.post.collection_id)}:null},tags:function(){var t;return null===(t=this.post)||void 0===t?void 0:t.color_tag},isStar:function(){var t;return null===(t=this.post)||void 0===t?void 0:t.is_star},isTop:function(){var t,e;return(null===(t=this.post)||void 0===t?void 0:t.is_top)||(null===(e=this.post)||void 0===e?void 0:e.is_category_top)},title:function(){var t;return(null===(t=this.post)||void 0===t?void 0:t.title)||"无标题"}},mounted:function(){document.addEventListener("scroll",this.handleScroll)},beforeDestroy:function(){document.removeEventListener("scroll",this.handleScroll)},methods:{handleScroll:function(){var t=document.getElementsByClassName("m-single-header");if(t.length){var e=t[0].getBoundingClientRect();document.documentElement.scrollTop>e.y+e.height?this.show=!0:this.show=!1}}}},wt=_t,Ct=(i("055f"),Object(g["a"])(wt,yt,bt,!1,null,"f43a3c28",null)),kt=Ct.exports,xt=i("98e8"),Lt=i("f175"),Rt={name:"CommunitySingleLayout",props:["post"],data:function(){return{id:Object(T["getAppID"])()}},computed:{isTeammate:function(){return I["a"].isTeammate()},user_id:function(){return this.post?this.post.user_id:""},title:function(){return this.post?this.post.title:document.title},finalPost:function(){return Object(a["a"])(Object(a["a"])({},this.post),{},{post_title:this.post.title,ID:this.post.id,post_type:"community"})}},mounted:function(){},methods:{getAppIcon:T["getAppIcon"]},components:{"publish-gate":xt["a"],AdminDrop:Lt["a"],TopStickyInfo:kt}},jt=Rt,Ot=(i("54f5"),Object(g["a"])(jt,vt,gt,!1,null,null,null)),Tt=Ot.exports,Bt=function(){var t=this,e=t._self._c;return t.post?e("header",{staticClass:"m-single-header"},[e("div",{staticClass:"m-single-title"},[e("span",{staticClass:"u-title u-sub-block"},[t._t("title_before"),t.styles?e("div",{staticClass:"m-topic-category-box"},[e("div",{class:"m-topic-category",style:"background-color: ".concat(t.styles.hoverColor,";color:").concat(t.styles.color,";")},[e("img",{directives:[{name:"svg-inline",rawName:"v-svg-inline"}],staticClass:"u-icon",attrs:{src:i("1c2f")("./".concat(t.styles.icon,".svg"))}}),e("div",[t._v(t._s(t.post.category))])])]):t._e(),"publish"!=t.post.post_status||~~t.post.visible?e("i",{staticClass:"u-private"},["draft"==t.post.post_status||"pending"==t.post.post_status||~~t.post.visible?e("i",{staticClass:"el-icon-lock",staticStyle:{color:"#fb9b24"}}):t._e(),"dustbin"==t.post.post_status?e("i",{staticClass:"el-icon-delete",staticStyle:{color:"#c00"}}):t._e()]):t._e(),e("span",{staticClass:"u-title-text",style:t.hightStyle},[t._v(t._s(t.title))]),e("div",{staticClass:"u-title-toolbar"},[t.isPostOwner?e("el-button",{attrs:{size:"small",type:"warning",icon:"el-icon-edit"},on:{click:t.onEditClick}},[t._v("编辑")]):t._e(),e("el-button",{class:"u-only-btn ".concat(t.onlyAuthor&&"u-unset"),attrs:{size:"small",type:"primary"},on:{click:function(e){return t.setOnlyAuthor(!t.onlyAuthor)}}},[e("svg",{directives:[{name:"show",rawName:"v-show",value:!t.onlyAuthor,expression:"!onlyAuthor"}],attrs:{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none","svg-inline":"",role:"presentation",focusable:"false",tabindex:"-1"}},[e("path",{attrs:{"fill-rule":"evenodd",fill:"#FFF",d:"M8 .667c2.21 0 4 1.79 4 4s-1.79 4-4 4-4-1.79-4-4 1.79-4 4-4zM8 2a2.666 2.666 0 110 5.333A2.666 2.666 0 118 2zm6 9.333v-.666a2 2 0 00-4 0v.666h-.667v3.334h5.333v-3.334H14zM2.667 14.667H4a4 4 0 014-4V9.333a5.333 5.333 0 00-5.333 5.334zM12 10c.368 0 .666.299.666.667v.666h-1.333v-.666c0-.368.299-.667.667-.667z"}})]),t._v(" "+t._s(t.onlyAuthor?"取消只看楼主":"只看楼主")+" ")])],1)],2)]),e("div",{staticClass:"m-single-info"},[t._t("default"),t.isTop?e("span",{staticClass:"u-status u-sub-block top"},[e("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 14 14",fill:"none","svg-inline":"",role:"presentation",focusable:"false",tabindex:"-1"}},[e("path",{attrs:{"fill-rule":"evenodd",fill:"#FFF",d:"M14 1.647H0V0h14v1.647zm-.778 6.405L7 3.294.778 8.052h4.666V14h3.112V8.052h4.666z"}})]),t._v(" 置顶 ")]):t._e(),t.isStar?e("span",{staticClass:"u-status u-sub-block star"},[e("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:"15",height:"15",viewBox:"0 0 15 15",fill:"none","svg-inline":"",role:"presentation",focusable:"false",tabindex:"-1"}},[e("path",{attrs:{d:"M15 7.5L9.515 5.485 7.5 0 5.485 5.485 0 7.5l5.485 2.015L7.5 15l2.015-5.485L15 7.5z",fill:"#FFF"}})]),t._v(" 精选 ")]):t._e(),t._l(t.tags,(function(i,n){return e("span",{key:n,staticClass:"u-tag u-sub-block",style:{backgroundColor:i.color}},[t._v(" "+t._s(i.label)+" ")])})),t.collection?e("a",{staticClass:"u-book u-sub-block",attrs:{href:t.collection.url,target:"_blank"}},[e("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:"11",height:"16",viewBox:"0 0 11 16",fill:"none","svg-inline":"",role:"presentation",focusable:"false",tabindex:"-1"}},[e("path",{attrs:{"fill-rule":"evenodd",fill:"#A6A6A6",d:"M5.5 12.1L0 16V0h11v16l-5.5-3.9z"}})]),t._v(" "+t._s(t.collection.name)+" ")]):t._e(),e("span",{staticClass:"u-sub-block",attrs:{title:"发布日期:"+t.post_time}},[e("i",{staticClass:"u-icon-podate"},[e("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"#6a737d",viewBox:"0 0 485.2 485.2","svg-inline":"",role:"presentation",focusable:"false",tabindex:"-1"}},[e("path",{attrs:{d:"M60.7 75.8V15.2C60.7 6.8 67.4 0 75.8 0 84.2 0 91 6.8 91 15.2v60.7C91 84.2 84.2 91 75.8 91c-8.4 0-15.1-6.8-15.1-15.2zM318.4 91c8.4 0 15.2-6.8 15.2-15.2V15.2c0-8.4-6.8-15.2-15.2-15.2-8.4 0-15.2 6.8-15.2 15.2v60.7c.1 8.3 6.8 15.1 15.2 15.1zM60.7 182h60.7v60.7H60.7zM60.7 272.9h60.7v60.7H60.7zM151.6 182h60.7v60.7h-60.7zM151.6 272.9h60.7v60.7h-60.7z"}}),e("path",{attrs:{d:"M30 361.2v-210h334c.2 70.7.4 141.4.7 212.1 9.8 0 19.6-.1 29.3-.1V93.6c0-18.5-14.5-33.4-32.5-33.4H349v15.2c0 16.7-13.7 30.3-30.5 30.3S288 92.1 288 75.4V60.2H106v15.2c0 16.7-13.7 30.3-30.5 30.3S45 92.1 45 75.4V60.2H32.5c-18 0-32.5 15-32.5 33.4v267.2c0 9.2 3.6 17.5 9.5 23.6 7.8 8.1 18.5 9.3 23 9.8 22.1 2.4 165.3 2.9 361.5 1v-32c-120.5.3-241 .7-361.5 1-.8-1-1.7-2-2.5-3z"}}),e("path",{attrs:{d:"M242.6 182h60.6v60.7h-60.6zM242.6 272.9h60.7v60.7h-60.7z"}})])]),e("time",[t._v(t._s(t.post_date))])]),e("span",{staticClass:"u-views u-sub-block"},[e("i",{staticClass:"el-icon-view"}),t._v(" "+t._s(t.views)+" ")]),t.wordCount?e("span",{staticClass:"u-word-count u-sub-block",attrs:{title:"累计字数"}},[e("i",{staticClass:"el-icon-sunny"}),t._v(" "+t._s(t.wordCount)+" ")]):t._e(),t._t("append")],2),e("div",{staticClass:"u-title-toolbar u-phone-show"},[t.isPostOwner?e("el-button",{attrs:{size:"small",type:"warning",icon:"el-icon-edit"},on:{click:t.onEditClick}},[t._v("编辑")]):t._e(),e("el-button",{class:"u-only-btn ".concat(t.onlyAuthor&&"u-unset"),attrs:{size:"small",type:"primary"},on:{click:function(e){return t.setOnlyAuthor(!t.onlyAuthor)}}},[e("svg",{directives:[{name:"show",rawName:"v-show",value:!t.onlyAuthor,expression:"!onlyAuthor"}],attrs:{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none","svg-inline":"",role:"presentation",focusable:"false",tabindex:"-1"}},[e("path",{attrs:{"fill-rule":"evenodd",fill:"#FFF",d:"M8 .667c2.21 0 4 1.79 4 4s-1.79 4-4 4-4-1.79-4-4 1.79-4 4-4zM8 2a2.666 2.666 0 110 5.333A2.666 2.666 0 118 2zm6 9.333v-.666a2 2 0 00-4 0v.666h-.667v3.334h5.333v-3.334H14zM2.667 14.667H4a4 4 0 014-4V9.333a5.333 5.333 0 00-5.333 5.334zM12 10c.368 0 .666.299.666.667v.666h-1.333v-.666c0-.368.299-.667.667-.667z"}})]),t._v(" "+t._s(t.onlyAuthor?"取消只看楼主":"只看楼主")+" ")])],1)]):t._e()},Mt=[],Ft=(i("ac1f"),i("5319"),i("65c2")),St=i("e4f1"),At=i("1157"),It=i.n(At),$t=i("6f4a"),zt=i("c402"),Dt={name:"single-header",props:["post","stat"],inject:["setOnlyAuthor"],data:function(){return{categoryList:[],wordCount:0}},computed:{hightStyle:function(){return this.post.is_hight&&this.post.hight_color?{color:this.post.hight_color}:{}},onlyAuthor:function(){var t=this.$route.query.onlyAuthor;return(1==t||"true"==t)&&!0},isPostOwner:function(){var t,e;return(null===(t=this.post)||void 0===t?void 0:t.user_id)==(null===(e=I["a"].getInfo())||void 0===e?void 0:e.uid)},collection:function(){return this.post.collection&&this.post.collection.title?{name:this.post.collection.title,url:"/collection/".concat(this.post.collection_id)}:null},tags:function(){var t;return(null===(t=this.post)||void 0===t?void 0:t.color_tag)||[]},isStar:function(){var t;return null===(t=this.post)||void 0===t?void 0:t.is_star},isTop:function(){var t,e;return(null===(t=this.post)||void 0===t?void 0:t.is_top)||(null===(e=this.post)||void 0===e?void 0:e.is_category_top)},title:function(){var t;return(null===(t=this.post)||void 0===t?void 0:t.title)||"无标题"},post_date:function(){var t;return Object(St["a"])(new Date(null===(t=this.post)||void 0===t?void 0:t.created_at))},update_date:function(){var t;return Object(St["a"])(new Date(null===(t=this.post)||void 0===t?void 0:t.updated_at))},post_time:function(){var t;return Object(St["b"])(new Date(null===(t=this.post)||void 0===t?void 0:t.created_at))},update_time:function(){var t;return Object(St["b"])(new Date(null===(t=this.post)||void 0===t?void 0:t.updated_at))},views:function(){var t;return(null===(t=this.stat)||void 0===t?void 0:t.views)||"-"},edit_link:function(){var t,e;return Object(T["editLink"])(null===(t=this.post)||void 0===t?void 0:t.post_type,null===(e=this.post)||void 0===e?void 0:e.ID)},canEdit:function(){var t;return(null===(t=this.post)||void 0===t?void 0:t.user_id)==I["a"].getInfo().uid||I["a"].isEditor()},styles:function(){var t=this,e=this.categoryList.find((function(e){return e.value===t.post.category}));return e||null}},watch:{post:{deep:!0,handler:function(t){this.countWords()}}},methods:{showClientLabel:function(t){return Ft["__clients"][t]},countWords:function(){var t=this;this.$nextTick((function(){var e,i=null===(e=It()(".c-article").text())||void 0===e?void 0:e.replace(/[\s|\n|\r|\t|\g|\ |\~|\`|\!|\@|\#|\$|\%|\^|\&|\*|\(|\)|\-|\_|\+|\=|\||\\|\[|\]|\{|\}|\;|\:|\"|\'|\,|\<|\.|\>|\/|\?|\，|\。|\？|\：|\；|\‘|\’|\”|\“|\、|\·|\！|\（|\）|\》|\《|\『|\』]/g,"");t.wordCount=(null===i||void 0===i?void 0:i.length)||0}))},getCategoryList:function(){var t=this;Object(zt["b"])({type:"community",search:this.post.category}).then((function(e){t.categoryList=Object($t["a"])(e.data.data)}))},onEditClick:function(){var t;window.location.href=Object(T["editLink"])("community",null===(t=this.post)||void 0===t?void 0:t.id)}},mounted:function(){this.getCategoryList()}},Et=Dt,Ht=(i("f823"),Object(g["a"])(Et,Bt,Mt,!1,null,null,null)),Pt=Ht.exports,Ut=function(){var t=this,e=t._self._c;return e("el-form",{ref:"form",staticClass:"c-comment-box m-comment-reply",attrs:{model:t.newComment}},[e("el-form-item",[e("el-input",{attrs:{rows:"6",type:"textarea",maxlength:t.maxLength,"show-word-limit":"",placeholder:"参与讨论...",id:t.inputId},model:{value:t.newComment.content,callback:function(e){t.$set(t.newComment,"content",e)},expression:"newComment.content"}}),e("div",{staticClass:"c-comment-tools"},[e("div",{staticClass:"u-tools"},[e("i",{staticClass:"el-icon-picture-outline u-upload-icon",on:{click:function(e){t.showUploader=!t.showUploader}}}),e("Emotion",{staticClass:"c-comment-emotion",attrs:{type:"pop",max:6},on:{selected:t.handleEmotionSelected}}),e("quickReply",{on:{reply:t.onQuickReply}})],1)]),e("div",{staticClass:"u-toolbar"},[e("el-button",{staticClass:"u-publish",attrs:{type:"primary",disabled:t.disableSubmitBtn},on:{click:t.onSubmit}},[t._v(" 跟帖 ")])],1),t.showUploader?e("Uploader",{ref:"uploader",staticClass:"u-uploader",on:{onFinish:t.attachmentUploadFinish,onError:t.attachmentUplodError}}):t._e()],1)],1)},Vt=[],qt=(i("13d5"),function(){var t=this,e=t._self._c;return e("div",[e("el-upload",{ref:"upload",attrs:{action:t.url,"list-type":"picture-card","on-preview":t.handlePictureCardPreview,"auto-upload":!1,"file-list":t.fileList,limit:t.maxCount,accept:t.acceptedExtensions.reduce((function(t,e){return t+".".concat(e,",")}),""),multiple:"","with-credentials":"","on-exceed":t.onExceed,"on-change":t.onChange,"on-success":t.onSuccess,"on-error":t.onError}},[e("i",{staticClass:"el-icon-plus"}),e("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v(" 最多上传 "+t._s(t.maxCount)+" 张 "+t._s(t.acceptedExtensions.join(" / ").toUpperCase())+" 格式图片，单张图片不能超过 "+t._s(t.maxSize/1024/1024)+" MB ")])]),e("el-dialog",{attrs:{visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("img",{attrs:{width:"60%",src:t.dialogImageUrl,alt:""}})])],1)}),Nt=[],Jt=Ft["__cms"],Qt=Jt+"api/cms/upload",Yt={data:function(){return{url:Qt,dialogImageUrl:"",dialogVisible:!1,fileList:[],successList:[],acceptedExtensions:["jpg","jpeg","png","gif"],maxCount:5,maxSize:10485760}},methods:{handlePictureCardPreview:function(t){this.dialogImageUrl=t.url,this.dialogVisible=!0},onExceed:function(){this.$notify({title:"",message:"最多上传 ".concat(this.maxCount," 张图片！"),type:"error",duration:3e3,position:"bottom-right"})},onChange:function(t,e){"ready"==t.status&&(t.size>this.maxSize?(this.$notify({title:"",message:"单张图片大小不能超过 ".concat(this.maxSize/1024/1024," MB！"),type:"error",duration:3e3,position:"bottom-right"}),e.pop()):this.fileList=e)},upload:function(){this.fileList.length>0?this.$refs.upload.submit():this.$emit("onFinish",[])},onSuccess:function(t){this.successList=this.successList.concat(t.data),0===t.code?this.successList.length==this.fileList.length&&(this.$emit("onFinish",this.successList||[]),this.fileList=[],this.successList=[]):this.onError(t.msg)},onError:function(t){this.$notify({title:"",message:t||"图片上传失败!",type:"error",duration:3e3,position:"bottom-right"}),this.$emit("onError"),this.fileList=[]}}},Wt=Yt,Xt=Object(g["a"])(Wt,qt,Nt,!1,null,null,null),Gt=Xt.exports,Kt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"c-jx3box-reply"},[e("el-popover",{ref:"quickReply",attrs:{"visible-arrow":!0,placement:"top",trigger:"click","popper-class":"c-jx3box-reply-pop"}},[e("div",{staticClass:"c-jx3box-reply-pop__content"},[e("i",{staticClass:"el-icon-close u-close",on:{click:t.closePop}}),e("div",{staticClass:"u-title"},[t._v("快捷回复")]),e("div",{staticClass:"m-reply-list"},t._l(t.replyTemplate,(function(i,n){return e("div",{key:n,staticClass:"m-reply-list__item",on:{click:function(e){return t.reply(i)}}},[t._v(" "+t._s(i)+" ")])})),0)]),e("img",{staticClass:"u-reference",attrs:{slot:"reference",width:"24",height:"24",src:i("9c54"),alt:"comment"},slot:"reference"})])],1)},Zt=[],te={name:"QuickReply",data:function(){return{replyTemplate:["真不错，谢谢楼主#胜利#笨猪#胜利","辛苦了，感谢楼主的付出","谢谢楼主，很有用","剑三真好玩，魔盒真好用"]}},emits:["reply"],methods:{closePop:function(){this.$refs.quickReply&&this.$refs.quickReply.doClose()},reply:function(t){this.$emit("reply",t),this.closePop()}}},ee=te,ie=(i("e934"),Object(g["a"])(ee,Kt,Zt,!1,null,"1bb1d831",null)),ne=ie.exports,se={name:"CommentInputForm",components:{Uploader:Gt,Emotion:C["a"],quickReply:ne},props:{isBottom:{type:Boolean,default:!1}},mounted:function(){this.isBottom&&(this.inputId="textarea-bottom")},data:function(){return{maxLength:500,showUploader:!1,disableSubmitBtn:!1,newComment:{content:""},inputId:"textarea-top",is_secret:!1}},methods:{onSubmit:function(){this.disableSubmitBtn=!0,this.$refs.uploader?this.$refs.uploader.upload():this.attachmentUploadFinish([])},onQuickReply:function(t){this.$emit("submit",{content:t,attachmentList:[],is_template:1})},attachmentUploadFinish:function(t){this.$emit("submit",{content:this.newComment.content,is_secret:this.is_secret?1:0,attachmentList:t}),this.newComment={content:""},this.showUploader=!1,this.disableSubmitBtn=!1},attachmentUplodError:function(){this.disableSubmitBtn=!1},handleEmotionSelected:function(t){this.insertVariable(t)},insertVariable:function(t){var e=this;return Object(r["a"])(Object(o["a"])().mark((function i(){var n,s,a,r;return Object(o["a"])().wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(n=document.querySelector("#".concat(e.inputId)),s=t.key,!n.selectionStart&&0!==n.selectionStart){i.next=12;break}return a=n.selectionStart,r=n.selectionEnd,e.newComment.content=n.value.substring(0,a)+s+n.value.substring(r,n.value.length),i.next=8,e.$nextTick();case 8:n.focus(),n.setSelectionRange(r+s.length,r+s.length),i.next=13;break;case 12:e.newComment.content=s;case 13:case"end":return i.stop()}}),i)})))()}}},oe=se,ae=(i("8ecb"),Object(g["a"])(oe,Ut,Vt,!1,null,null,null)),re=ae.exports,ce="community",le={components:{CommentEditor:re,CommunitySingleLayout:Tt,PostHeader:Pt,ReplyItem:ft},provide:function(){var t=this;return{getTopicData:function(){return t.post},getReplyList:this.getReplyList,setOnlyAuthor:this.setOnlyAuthor,onReplyTopic:this.onReplyTopic,onSearch:this.onSearch}},data:function(){return{floor:0,stat:"",page:1,per:10,total:0,pageTotal:0,post:{},replyList:[],categoryList:[],loading:!1,onlyAuthor:!1,number_queries:["per","page"]}},computed:{styles:function(){var t=this,e=this.categoryList.find((function(e){return e.value===t.post.category}));return e||{icon:"game",hoverColor:"rgba(235, 244, 255, 1)",color:"rgba(64, 128, 255, 1)"}},id:function(){return this.$route.params.id},isAuthor:function(){var t;return(null===(t=this.post)||void 0===t?void 0:t.user_id)==I["a"].getInfo().uid}},created:function(){this.getJumpFloor()},mounted:function(){if(!this.id)return this.$message.error("文章id不存在");this.getDetails(),this.getReplyList()},watch:{"$route.query":{deep:!0,immediate:!0,handler:function(t){if(Object.keys(t).length)for(var e in t)this.number_queries.includes(e)?this[e]=~~t[e]:this[e]=t[e]}}},methods:{getJumpFloor:function(){var t=window.location.hash,e=t.substring(1).split("?")[0];e&&(this.floor=e,this.page=Math.ceil((e-1)/this.per))},jumpFloor:function(t){var e=t||this.floor;this.$nextTick((function(){var t=document.getElementById("floor-"+e);t&&(t.scrollIntoView(),window.scrollBy(0,-120))}))},onSearch:function(){var t=this;this.page=1,this.$nextTick((function(){t.getReplyList()}))},setOnlyAuthor:function(t){this.page=1,this.onlyAuthor=t,this.getReplyList()},buildQuery:function(t){var e={index:this.page,pageSize:this.per,order_created_at:0};return!this.onlyAuthor||1!=this.onlyAuthor&&"true"!=this.onlyAuthor||(e.user_id=this.post.user_id),this.replaceRoute({page:this.page,onlyAuthor:this.onlyAuthor}),e},getTopicData:function(){return this.post},getDetails:function(){var t=this;Object(M["i"])(this.id).then((function(e){t.post=e.data.data,Object(F["a"])(ce,t.id).then((function(e){t.stat=e.data,t.$set(t.post,"likes",t.stat.likes||0)})),Object(F["b"])(ce,t.id)}))},getReplyList:function(){var t=this;this.loading=!0;var e=this.buildQuery();return Object(M["k"])(this.id,e).then(function(){var e=Object(r["a"])(Object(o["a"])().mark((function e(i){var n,s;return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=i.data.data.list,s=i.data.data.page,null!=n){e.next=6;break}t.replyList=[],e.next=11;break;case 6:return e.next=8,t.getLikes(n);case 8:n=e.sent,t.replyList=n.map((function(t,e){return Object(a["a"])({},t)})),t.floor&&t.jumpFloor();case 11:t.total=s.total,t.pageTotal=s.pageTotal,t.$nextTick((function(){t.page=s.index}));case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).finally((function(){t.loading=!1}))},getLikes:function(t){return Object(r["a"])(Object(o["a"])().mark((function e(){var i,n,s;return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=t.map((function(t){return"community_reply-".concat(t.id)})),n=i.join(","),s=[],e.next=5,Object(lt["b"])({post_type:"community_reply",post_action:"likes",id:n}).then((function(e){s=t.map((function(t){var i;return t.likes=(null===(i=e.data.data["community_reply-".concat(t.id)])||void 0===i?void 0:i.likes)||0,t}))})).catch((function(){s=t}));case 5:return e.abrupt("return",s);case 6:case"end":return e.stop()}}),e)})))()},onReplyTopic:function(t){var e=this,i=t.attachmentList,n=t.content;if(console.log(i),!this.id)return this.$message.error("文章id不存在");if(i&&i.length){var s=i.map((function(t){return"<p><img class='attachment' src=\"".concat(t,'" /></p>')})).join("");n+=s}Object(M["p"])(this.id,{client:location.href.includes("origin")?"origin":"std",content:n}).then((function(t){e.onReplyTopicSuccess(t.data.data)}))},onReplyTopicSuccess:function(t){var e=this;if(this.replyList.length+1<=this.per){var i=I["a"].getInfo();this.replyList.push(Object(a["a"])(Object(a["a"])({},t),{},{user_info:{id:Number(i.uid),display_name:i.name,avatar:i.avatar}})),this.$nextTick((function(){window.scrollTo(0,document.body.scrollHeight)}))}else this.total=this.total+1,this.page=Math.ceil((this.total+1)/this.per),this.$nextTick((function(){e.getReplyList().finally((function(){window.scrollTo(0,document.body.scrollHeight)}))}))},changePage:function(t){this.page=t,this.getReplyList()},replaceRoute:function(t){return this.$router.push({name:this.$route.name,query:Object.assign({},this.$route.query,t)}).then((function(){window.scrollTo(0,0)})).catch((function(t){}))}}},ue=le,pe=(i("35d1"),Object(g["a"])(ue,n,s,!1,null,null,null));e["default"]=pe.exports},"055f":function(t,e,i){"use strict";i("5b0b")},"076f":function(t,e,i){t.exports=i.p+"img/reply.7dfa9d81.svg"},"09fb":function(t,e,i){"use strict";i("a5d8")},"2ed4":function(t,e,i){"use strict";i("f78f")},"35d1":function(t,e,i){"use strict";i("fe73")},"423c":function(t,e,i){"use strict";i("4f35")},"4a11":function(t,e,i){t.exports=i.p+"img/praise.f6d89055.svg"},"4f35":function(t,e,i){},"54f5":function(t,e,i){"use strict";i("daf5")},"552d":function(t,e,i){"use strict";i("9a47")},"5b0b":function(t,e,i){},"66e5":function(t,e,i){"use strict";i("dc7c")},"683a":function(t,e,i){},"69a6":function(t,e,i){},"8ecb":function(t,e,i){"use strict";i("683a")},"9a47":function(t,e,i){},"9c54":function(t,e,i){t.exports=i.p+"img/comment.2840ad61.svg"},a27f:function(t,e,i){"use strict";i.d(e,"b",(function(){return s})),i.d(e,"a",(function(){return o}));var n=i("41cb");function s(t){return Object(n["c"])().get("/api/summary/batch",{params:t})}function o(t){return Object(n["c"])().get("/api/next2/users/birthday/today",{params:t})}},a5d8:function(t,e,i){},a732:function(t,e,i){},c402:function(t,e,i){"use strict";i.d(e,"b",(function(){return s})),i.d(e,"a",(function(){return o})),i.d(e,"c",(function(){return a}));var n=i("41cb");function s(t){return Object(n["a"])().get("/api/cms/topic/bucket",{params:t})}var o=function(t){return Object(n["a"])().get("api/cms/config/banner",{params:t})},a=function(t){return Object(n["a"])().get("/api/cms/user/list",{params:t})}},daf5:function(t,e,i){},dc7c:function(t,e,i){},e59c:function(t,e,i){t.exports=i.p+"img/collapse_2.b4244534.svg"},e934:function(t,e,i){"use strict";i("69a6")},f315:function(t,e,i){t.exports=i.p+"img/collapse_1.74036d18.svg"},f78f:function(t,e,i){},f823:function(t,e,i){"use strict";i("a732")},fe73:function(t,e,i){}}]);
//# sourceMappingURL=chunk-2c561cd2.729575bb.js.map