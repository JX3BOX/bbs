(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-06eb1d32"],{"33a5":function(t){t.exports=JSON.parse('{"0":"江湖","1":"天策","2":"万花","3":"纯阳","4":"七秀","5":"少林","6":"藏剑","7":"丐帮","8":"明教","9":"五毒","10":"唐门","18":"苍云","19":"长歌","20":"霸刀","21":"蓬莱","22":"凌雪","23":"衍天"}')},"5ca7":function(t,e,a){},"976f":function(t,e,a){"use strict";a("5ca7")},ecfb:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"v-joke"},[t.id?a("div",{staticClass:"m-joke-single-container"},[a("div",{staticClass:"m-joke-goback"},[a("el-button",{attrs:{size:"mini",icon:"el-icon-arrow-left"},on:{click:t.goBack}},[t._v("返回列表")]),t._m(0)],1),a("el-row",{staticClass:"v-joke-list",attrs:{gutter:20}},[a("el-col",{staticClass:"item",attrs:{span:24}},[a("div",{staticClass:"v-joke-list-item"},[a("joke-item",{attrs:{joke:t.joke,mode:"single"}})],1)])],1),t.joke.tags&&t.joke.tags.length?a("div",{staticClass:"m-joke-tags"},[a("i",{staticClass:"el-icon-price-tag"}),t._l(t.joke.tags,(function(e,i){return a("span",{key:i,staticClass:"u-tag"},[t._v(t._s(e))])}))],2):t._e(),a("Thx",{staticClass:"m-thx",attrs:{postId:t.id,postType:"joke",userId:t.user_id,adminBoxcoinEnable:!1,userBoxcoinEnable:!0}}),a("div",{staticClass:"m-single-comment"},[a("el-divider",{attrs:{"content-position":"left"}},[t._v("评论")]),t.id&&!t.joke.comment?a("Comment",{attrs:{id:t.id,category:"post"}}):a("el-alert",{attrs:{title:"作者没有开启评论功能",type:"warning","show-icon":""}})],1)],1):a("div",{staticClass:"m-joke-list-container"},[a("div",{staticClass:"m-joke-search",attrs:{slot:"search-before"},slot:"search-before"},[a("el-input",{attrs:{placeholder:"请输入搜索内容"},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}},[a("span",{attrs:{slot:"prepend"},slot:"prepend"},[t._v("关键词")]),a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},slot:"append"})],1)],1),a("div",{staticClass:"m-joke-types"},[a("el-tabs",{model:{value:t.type,callback:function(e){t.type=e},expression:"type"}},[a("el-tab-pane",{attrs:{name:"all",label:"全部"}}),t._l(t.schoolmap,(function(e,i){return a("el-tab-pane",{key:i,attrs:{name:i}},[a("div",{staticStyle:{"min-width":"57px"},attrs:{slot:"label"},slot:"label"},[a("img",{staticClass:"u-icon",attrs:{src:t._f("showSchoolIcon")(i),alt:e}}),t._v(" "+t._s(e)+" ")])])}))],2)],1),t.jokes&&t.jokes.length?a("el-row",{staticClass:"v-joke-list",attrs:{gutter:20}},t._l(t.jokes,(function(e){return a("el-col",{key:e.ID,staticClass:"item",attrs:{span:24}},[a("div",{staticClass:"v-joke-list-item"},[a("joke-item",{attrs:{joke:e},on:{update:t.handleJokeUpdate}})],1)])})),1):a("el-alert",{attrs:{title:"没有找到相关条目",type:"info","show-icon":""}}),a("el-pagination",{staticClass:"v-joke-pagination",attrs:{background:"","page-size":t.per,"hide-on-single-page":!0,"current-page":t.page,layout:"total, prev, pager, next, jumper",total:t.total},on:{"update:currentPage":function(e){t.page=e},"update:current-page":function(e){t.page=e},"current-change":t.skipTop}})],1)])},s=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a",{staticClass:"u-doc",attrs:{href:"/tool/23239",target:"_blank"}},[a("i",{staticClass:"el-icon-info"}),t._v("游戏内获取或发布骚话 ")])}],o=(a("ac1f"),a("841c"),a("b64b"),a("4e82"),a("159b"),a("d3b7"),a("d81d"),a("65c2")),n=a("e9a5"),r=a("41cb"),l=function(t){var e=Object.assign(t,{type:"joke"});return Object(r["b"])().get("/api/cms/posts",{params:e})};function c(t){return Object(r["b"])().get("/api/cms/post/".concat(t))}var u=function(t){var e=t.id,a=t.data;return Object(r["b"])().put("/api/cms/post/".concat(e,"/setting"),a)},d=function(t){return Object(r["b"])().put("/api/cms/post/".concat(t,"/setting"),{post_status:"dustbin"})},p=function(t){return Object(r["b"])().get("/api/cms/user/".concat(t,"/info"))},h=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"m-joke-item"},[i("div",{staticClass:"content"},[t.isEditor?i("i",{staticClass:"u-star-op",class:t.isMark?"on":"",on:{click:t.handleMark}},[t._v("★")]):i("i",{directives:[{name:"show",rawName:"v-show",value:t.isMark,expression:"isMark"}],staticClass:"u-star"},[t._v("★")]),i("span",{staticClass:"u-sentence",domProps:{innerHTML:t._s(t.parse(t.joke.post_title))}})]),i("div",{staticClass:"misc"},[i("div",{staticClass:"op"},[i("span",{staticClass:"user"},[i("img",{attrs:{width:"24",height:"24",src:t._f("showAvatar")(t.authorAvatar)}}),t.joke.post_author&&1!=t.joke.post_author?i("a",{attrs:{href:t._f("authorLink")(t.joke.post_author),target:"_blank"}},[t._v(t._s(t.authorName))]):i("span",[t._v(t._s(t.authorName))])]),i("el-link",{staticClass:"copy-btn",attrs:{type:"primary",disabled:t.disabled},on:{click:function(e){return t.handleCopy(t.joke.post_title)}}},[i("i",{staticClass:"el-icon-document-copy"}),t._v(" "+t._s(t.copyLabel)+" ")]),"single"!==t.mode?i("router-link",{staticClass:"el-link el-link--primary is-underline copy-btn",attrs:{to:"/joke/"+t.joke.ID}},[i("i",{staticClass:"el-icon-chat-dot-square"}),t._v("评论 ")]):t._e(),"single"===t.mode?i("a",{staticClass:"u-edit el-link el-link--primary is-underline",attrs:{href:t.editLink("joke",t.joke.ID),target:"_blank"}},[i("i",{staticClass:"el-icon-edit-outline"}),t._v(" 编辑 ")]):t._e(),i("span",{staticClass:"like",class:{disabled:!t.isLike},attrs:{title:"点赞"},on:{click:t.addLike}},[i("img",{staticClass:"like-icon",attrs:{src:a("0dab"),"svg-inline":""}}),i("span",{staticClass:"like-count"},[t._v(t._s(t.count))])])],1),i("div",{staticClass:"u-other"},[i("div",{staticClass:"u-time"},[i("span",{staticClass:"u-date"},[i("i",{staticClass:"el-icon-date"}),t._v("  "),i("time",[t._v(t._s(t._f("dateFormat")(t.joke.post_date)))])])])])]),i("i",{directives:[{name:"show",rawName:"v-show",value:t.isEditor,expression:"isEditor"}],staticClass:"el-icon-close u-joke-delete",attrs:{title:"删除"},on:{click:t.delJoke}})])},k=[],m=a("506c"),f=a("fb92"),v=a("85e4"),g=a("c9d2"),j={name:"joke_item",props:["joke","mode"],data:function(){return{copyLabel:"点击复制",disabled:!1,isMark:!1,authorInfo:null,count:0,isLike:!0}},watch:{joke:{deep:!0,immediate:!0,handler:function(){var t,e,a,i;(this.isMark=!(null===(t=this.joke)||void 0===t||null===(e=t.mark)||void 0===e||!e.length),"single"===this.mode)&&(null!==(i=this.joke)&&void 0!==i&&i.post_author&&this.loadAuthor(this.joke.post_author));this.count=(null===(a=this.joke)||void 0===a?void 0:a.count)||0}}},filters:{dateFormat:function(t){return Object(f["a"])(new Date(t))},showAvatar:function(t){return Object(v["showAvatar"])(t,24)},authorLink:v["authorLink"]},computed:{isEditor:function(){return g["a"].isEditor()},authorName:function(){var t,e,a,i;return(null===(t=this.authorInfo)||void 0===t?void 0:t.display_name)||(null===(e=this.joke)||void 0===e||null===(a=e.author_info)||void 0===a?void 0:a.display_name)||(null===(i=this.joke)||void 0===i?void 0:i.author)||"匿名"},authorAvatar:function(){var t,e,a;return(null===(t=this.authorInfo)||void 0===t?void 0:t.user_avatar)||(null===(e=this.joke)||void 0===e||null===(a=e.author_info)||void 0===a?void 0:a.user_avatar)||""}},methods:{addLike:function(){if(this.isLike){var t;if(this.count++,this.isLike)postStat("joke",null===(t=this.joke)||void 0===t?void 0:t.ID,"likes");this.isLike=!1}},parse:function(t){var e=new m["a"](t);return e.code},handleCopy:function(t){var e=this;this.disabled=!0,navigator.clipboard.writeText(t).then((function(){e.copyLabel="已复制",setTimeout((function(){e.copyLabel="点击复制",e.disabled=!1}),3e3)}))},editLink:v["editLink"],handleMark:function(){var t=this,e=this.isMark?[]:["recommended"];u({id:this.joke.ID,data:{mark:e}}).then((function(){t.$notify({title:"成功",message:t.isMark?"取消加精成功":"加精成功",type:"success"}),t.isMark=!!e.length,t.$forceUpdate()})).catch((function(e){t.$notify({title:"错误",message:(null===e||void 0===e?void 0:e.message)||"设置失败，请重试或者联系管理员",type:"error"})}))},delJoke:function(){var t=this;this.$confirm("此操作将会删除该骚话，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){d(t.joke.ID).then((function(){t.$notify({title:"成功",message:"删除成功",type:"success"}),"single"===t.mode?t.$router.go(-1):t.$emit("update")})).catch((function(e){t.$notify({title:"错误",message:(null===e||void 0===e?void 0:e.message)||"删除失败，请重试或者联系管理员",type:"error"})}))}))},loadAuthor:function(t){var e=this;p(t).then((function(t){e.authorInfo=t.data.data}))}}},_=j,b=a("2877"),y=Object(b["a"])(_,h,k,!1,null,null,null),C=y.exports,w=a("33a5"),L=a("23d8"),x={name:"Joke",components:{"joke-item":C,Comment:L["a"]},data:function(){return{loading:!1,sortedEmotions:[],schoolmap:w,type:"all",search:"",per:10,page:1,total:1,jokes:[],joke:""}},computed:{id:function(){return this.$route.params.id},params:function(t){var e=t.search,a=t.page,i=t.per,s={per:i,page:a,order:"post_date-DESC"};return"all"!=this.type&&(s.subtype=this.type),e&&Object.assign(s,{search:e}),s},keys:function(){return[this.search,this.page,this.per,this.type,this.id]},user_id:function(){var t;return(null===(t=this.joke)||void 0===t?void 0:t.post_author)||0}},filters:{showSchoolIcon:function(t){return o["__imgPath"]+"image/school/"+t+".png"}},methods:{sortEmotion:function(){var t=this,e=Object.keys(n);e.sort((function(t,e){return t.localeCompare(e)})),e.forEach((function(e){var a={key:e,value:n[e]};t.sortedEmotions.push(a)}))},loadList:function(){var t=this;this.loading=!0,l(this.params).then((function(e){t.jokes=e.data.data.list,t.total=e.data.data.total})).catch((function(t){})).finally((function(){t.loading=!1}))},loadSingle:function(){var t=this;this.loading=!0,c(this.id).then((function(e){t.joke=e.data.data})).finally((function(){t.loading=!1}))},init:function(){this.id?this.loadSingle():this.loadList()},goBack:function(){this.$router.push("/joke")},handleJokeUpdate:function(){this.loadList()},skipTop:function(){window.scrollTo(0,0)},loadLike:function(){var t=this,e=this.data.map((function(t){return t.ID}));getLikes(e).then((function(e){t.data.forEach((function(t){console.log(t)}))}))}},watch:{keys:{handler:function(){this.init()},deep:!0,immediate:!0}},created:function(){this.sortEmotion()}},E=x,I=(a("976f"),Object(b["a"])(E,i,s,!1,null,null,null));e["default"]=I.exports}}]);
//# sourceMappingURL=chunk-06eb1d32.1a3b1a1f.js.map